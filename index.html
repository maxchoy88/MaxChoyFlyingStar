/**
 * @file LifeCodeApp.jsx
 * @description æˆ˜ç•¥çº§ç”Ÿå‘½å…¨æ¯ç»ˆç«¯ v4.2 (GitHub å…¼å®¹ç‰ˆ)
 * @encoding UTF-8
 * @author Bo (AI Strategist) for Castor (é˜¿ç››)
 * * æ³¨æ„ï¼šä¸Šä¼ è‡³ GitHub å‰ï¼Œè¯·ç¡®ä¿ç¼–è¾‘å™¨å³ä¸‹è§’æ˜¾ç¤ºä¸º "UTF-8"ã€‚
 */

import React, { useState, useEffect, useMemo } from 'react';
import { 
  Zap, Shield, User, Heart, TrendingUp, 
  Crown, Compass, Briefcase, Share2, 
  Calculator, Sparkles, MessageSquare, Loader2, RefreshCw, 
  BarChart3, Settings, UserPlus, Info, Calendar,
  LineChart, Target, Edit3, Mars, Venus, Printer, MessageCircle,
  FileText, Activity, Hash, Binary, ChevronRight, Layout,
  PackageCheck, Hexagon, Binary as BinaryIcon, Gauge, Terminal,
  Code2, GitBranch, Github, Boxes, Workflow, Database, Search,
  Globe as LucideGlobe, Anchor as LucideAnchor
} from 'lucide-react';

// --- åŸºç¡€å›¾æ ‡ç»„ä»¶é¢„å®šä¹‰ (é˜²æ­¢åˆå§‹åŒ–é¡ºåºé”™è¯¯) ---
const Globe = (props) => <LucideGlobe {...props} />;
const Anchor = (props) => <LucideAnchor {...props} />;

const App = () => {
  // --- æ ¸å¿ƒè®¡ç®—å¼•æ“ (Pythagorean Alogorithm) ---
  const reduceNum = (n) => {
    if (!n) return 0;
    let num = Math.abs(parseInt(n));
    while (num > 9) {
      num = String(num).split('').reduce((acc, curr) => acc + parseInt(curr), 0);
    }
    return num;
  };

  const calculateFullMatrix = (y, m, d, analysisYear) => {
    const dStr = String(d).padStart(2, '0');
    const mStr = String(m).padStart(2, '0');
    const yStr = String(y);
    
    const d1 = parseInt(dStr[0]) || 0; const d2 = parseInt(dStr[1]) || 0;
    const m1 = parseInt(mStr[0]) || 0; const m2 = parseInt(mStr[1]) || 0;
    const yr1 = parseInt(yStr[0]) || 0; const yr2 = parseInt(yStr[1]) || 0;
    const yr3 = parseInt(yStr[2]) || 0; const yr4 = parseInt(yStr[3]) || 0;

    const A = reduceNum(d1 + d2); 
    const B = reduceNum(m1 + m2); 
    const C = reduceNum(reduceNum(yr1 + yr2) + reduceNum(yr3 + yr4)); 
    const D = reduceNum(A + B); 
    const E = reduceNum(B + C); 
    const F = reduceNum(D + E); 
    const G = reduceNum(A + D); 
    const H = reduceNum(C + E); 
    const I = reduceNum(D + F); 
    const J = reduceNum(E + F); 
    const K = reduceNum(I + J); 

    const personalYear = reduceNum(parseInt(analysisYear) + reduceNum(m) + reduceNum(d));

    // æ•°æ®åŒ–ç»´åº¦æ˜ å°„ (ç”¨äºå…«è§’é›·è¾¾)
    const metrics = [
      { label: 'æ‰§è¡Œé€Ÿåº¦', val: A * 11, color: '#f85149', icon: Zap },
      { label: 'æˆ˜ç•¥é€»è¾‘', val: D * 11, color: '#388bfd', icon: Workflow },
      { label: 'æ ¸å¿ƒèƒ½é‡', val: F * 11, color: '#79c0ff', icon: Crown },
      { label: 'ç¯å¢ƒé€‚åº”', val: C * 11, color: '#3fb950', icon: Globe },
      { label: 'ç›´è§‰æ•é”', val: B * 11, color: '#d2a8ff', icon: Heart },
      { label: 'é£é™©æ§åˆ¶', val: personalYear === 4 ? 94 : 50, color: '#ffa657', icon: Shield },
      { label: 'æœªæ¥å¢ç›Š', val: H * 11, color: '#a371f7', icon: TrendingUp },
      { label: 'åé•‡åº•è•´', val: K * 11, color: '#ff7b72', icon: Anchor }
    ];

    return { A, B, C, D, E, F, G, H, I, J, K, personalYear, metrics };
  };

  // --- çŠ¶æ€ç®¡ç† ---
  const [profile, setProfile] = useState({
    name: 'Castor é˜¿ç››',
    gender: 'Male',
    birthYear: 1980,
    birthMonth: 9,
    birthDay: 30,
    targetYear: 2026 
  });
  
  const [isEditingName, setIsEditingName] = useState(false);
  const [aiLoading, setAiLoading] = useState(false);
  const [aiResponse, setAiResponse] = useState('');
  const [chatInput, setChatInput] = useState('');

  const results = useMemo(() => {
    return calculateFullMatrix(profile.birthYear, profile.birthMonth, profile.birthDay, profile.targetYear);
  }, [profile.birthYear, profile.birthMonth, profile.birthDay, profile.targetYear]);

  const flowYears = [2024, 2025, 2026, 2027, 2028, 2029, 2030];
  const birthYears = Array.from({ length: 80 }, (_, i) => 1950 + i);
  const months = Array.from({ length: 12 }, (_, i) => i + 1);
  const days = Array.from({ length: 31 }, (_, i) => i + 1);

  // --- æ¸²æŸ“è¾…åŠ©é€»è¾‘ ---
  const getOctagonPoints = (cx, cy, r) => {
    let pts = [];
    for (let i = 0; i < 8; i++) {
      let angle = (i * 45 - 90) * (Math.PI / 180);
      pts.push(`${cx + r * Math.cos(angle)},${cy + r * Math.sin(angle)}`);
    }
    return pts.join(' ');
  };

  const getRadarPoints = (cx, cy, maxR, metrics) => {
    let pts = [];
    metrics.forEach((m, i) => {
      let r = (m.val / 100) * maxR;
      let angle = (i * 45 - 90) * (Math.PI / 180);
      pts.push(`${cx + r * Math.cos(angle)},${cy + r * Math.sin(angle)}`);
    });
    return pts.join(' ');
  };

  // --- AI äº¤äº’é€»è¾‘ ---
  const callGemini = async (prompt, systemPrompt = "") => {
    setAiLoading(true);
    const apiKey = ""; 
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
    try {
      const response = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }],
          systemInstruction: { parts: [{ text: systemPrompt }] }
        })
      });
      const data = await response.json();
      const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
      setAiResponse(typeof text === 'object' ? JSON.stringify(text) : String(text || ""));
    } catch (err) { setAiResponse(`[TERMINAL_ERROR]: ${err.message}`); }
    finally { setAiLoading(false); }
  };

  const handleChat = () => {
    if (!chatInput.trim() || !results) return;
    const prompt = `[CASTOR_QUERY]: ${chatInput}. Profile: ${results.F}-${results.K}, Flow: ${profile.targetYear}(${results.personalYear}).`;
    callGemini(prompt, "ä½ æ˜¯ä¸€ä½ç²¾é€šæˆ˜ç•¥ä¸æŠ•èµ„çš„ AI é¡¾é—®æ³¢ (Bo)ã€‚");
    setChatInput('');
  };

  const handleAiAnalyze = () => {
    const prompt = `è¯·åŸºäº GitHub æ–¹ç¨‹å¼åˆ†æé˜¿ç›› (Castor) 1980-09-30 çš„å‘½ç›˜ã€‚é‡ç‚¹è¯´æ˜å…¶åœ¨ 2026 æ¶æ„å¹´(4) çš„ U13 è¶³çƒé¡¹ç›®ç­–ç•¥ã€‚è¯·ä»¥ Git Log å’Œå®¡è®¡æŠ¥å‘Šçš„é£æ ¼å›ç­”ï¼Œå¹¶æåŠ Money å¯¹æƒ…ç»ªçš„å¯¹å†²ä½œç”¨ã€‚`;
    callGemini(prompt, "è¯·æä¾›ä¸€ä»½æ•´é½çš„ã€ä»£ç åŒ–é£æ ¼çš„ä¸­æ–‡æˆ˜ç•¥æŠ¥å‘Šã€‚");
  };

  const handleWhatsAppShare = () => {
    const message = encodeURIComponent(
      `ğŸ“‘ *CASTOR STRATEGIC BLUEPRINT* v4.2\n` +
      `------------------------------------\n` +
      `ğŸ”¢ ä¸»å‘½æ ¸: ${results.F} | åé•‡ä½: ${results.K}\n` +
      `âš¡ æµå¹´æ€: ${results.personalYear} (ç³»ç»ŸåŒ–æ„å»ºå¹´)\n` +
      `ğŸ“ˆ æ‰§è¡ŒåŠ›è¯„åˆ†: ${results.metrics[0].val}%\n` +
      `------------------------------------\n` +
      `>>> è¯¦ç»†æ•°æ®æŠ¥å‘Šå·²ä¸Šä¼  GitHub Repoï¼Œè¯·æŸ¥é˜…ã€‚`
    );
    window.open(`https://wa.me/?text=${message}`, '_blank');
  };

  return (
    <div className="min-h-screen bg-[#0d1117] text-[#c9d1d9] p-4 md:p-8 font-sans antialiased selection:bg-[#238636] selection:text-white">
      <div className="max-w-6xl mx-auto flex flex-col gap-6">
        
        {/* Header - GitHub Professional Style */}
        <div className="flex justify-between items-center border-b border-[#30363d] pb-6 no-print">
          <div className="flex items-center gap-4">
            <div className="p-3 bg-[#161b22] border border-[#30363d] rounded-xl text-[#58a6ff] shadow-inner">
              <Github size={28} />
            </div>
            <div>
              <div className="flex items-center gap-2">
                <h1 className="text-xl font-bold text-white tracking-tight">castor-life-v4.2</h1>
                <span className="text-[10px] font-bold border border-[#238636] px-2 py-0.5 rounded-full text-[#3fb950] bg-[#238636]/10">Stable Build</span>
              </div>
              <p className="text-xs text-[#8b949e] font-mono mt-1 flex items-center gap-2 uppercase tracking-tighter">
                <GitBranch size={12}/> prod-deployment / strategic-kernel
              </p>
            </div>
          </div>
          <div className="flex gap-3">
             <button onClick={handleWhatsAppShare} className="group flex items-center gap-2 px-4 py-2 bg-[#21262d] border border-[#30363d] rounded-lg text-sm font-semibold hover:border-[#8b949e] transition-all">
              <MessageCircle size={16} className="text-[#3fb950] group-hover:scale-110 transition-transform"/> <span className="hidden sm:inline">WhatsApp</span>
            </button>
            <button onClick={() => window.print()} className="flex items-center gap-2 px-4 py-2 bg-[#238636] border border-[#2ea44f] text-white rounded-lg text-sm font-semibold hover:bg-[#2ea44f] transition-all shadow-md">
              <Printer size={16} /> <span className="hidden sm:inline">Export PDF</span>
            </button>
            <button onClick={() => setIsEditingName(!isEditingName)} className="p-2.5 bg-[#21262d] border border-[#30363d] rounded-lg text-[#8b949e] hover:text-white transition-colors">
              <Edit3 size={18} />
            </button>
          </div>
        </div>

        {/* 1. å‚æ•°ä¸æµå¹´æ§åˆ¶å° */}
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 no-print">
          <div className="lg:col-span-8 bg-[#161b22] p-6 rounded-2xl border border-[#30363d]">
             <div className="flex justify-between items-center mb-6">
                <div className="flex items-center gap-2 text-white font-bold text-xs uppercase tracking-widest"><Terminal size={14} className="text-[#8b949e]"/> Config Interface</div>
                <div className="flex bg-[#0d1117] p-1 rounded-lg border border-[#30363d]">
                  <button onClick={() => setProfile({...profile, gender: 'Male'})} className={`px-4 py-1.5 rounded-md text-[10px] font-bold transition-all ${profile.gender === 'Male' ? 'bg-[#388bfd] text-white shadow-lg' : 'text-[#8b949e]'}`}>MALE</button>
                  <button onClick={() => setProfile({...profile, gender: 'Female'})} className={`px-4 py-1.5 rounded-md text-[10px] font-bold transition-all ${profile.gender === 'Female' ? 'bg-[#f85149] text-white shadow-lg' : 'text-[#8b949e]'}`}>FEMALE</button>
                </div>
             </div>
             <div className="grid grid-cols-3 gap-4 mb-6">
                {['YEAR', 'MONTH', 'DAY'].map((label, i) => (
                  <div key={label} className="space-y-1">
                    <span className="text-[9px] text-[#8b949e] font-bold ml-1 uppercase">{label}</span>
                    <select 
                      value={profile[i === 0 ? 'birthYear' : i === 1 ? 'birthMonth' : 'birthDay']} 
                      onChange={(e) => setProfile({...profile, [i === 0 ? 'birthYear' : i === 1 ? 'birthMonth' : 'birthDay']: parseInt(e.target.value)})} 
                      className="w-full bg-[#0d1117] border border-[#30363d] rounded-xl p-3 text-sm font-black text-white focus:border-[#58a6ff] outline-none"
                    >
                      {[birthYears, months, days][i].map(o => <option key={o} value={o}>{o}</option>)}
                    </select>
                  </div>
                ))}
             </div>
             <div className="pt-4 border-t border-[#30363d] flex gap-2 overflow-x-auto no-scrollbar">
                {flowYears.map(y => (
                  <button key={y} onClick={() => setProfile({...profile, targetYear: y})} className={`shrink-0 px-5 py-2 rounded-lg text-xs font-black transition-all border ${profile.targetYear === y ? 'bg-[#388bfd]/20 border-[#388bfd] text-[#58a6ff]' : 'bg-[#0d1117] border-[#30363d] text-[#8b949e]'}`}>{y}</button>
                ))}
             </div>
          </div>
          <div className="lg:col-span-4 bg-[#161b22] p-6 rounded-2xl border border-[#30363d] flex flex-col justify-center items-center text-center">
            <span className="text-[10px] font-bold text-[#8b949e] uppercase mb-2 tracking-widest">Commit Density</span>
            <div className="text-7xl font-black text-[#3fb950] tracking-tighter mb-2">{results.personalYear}</div>
            <div className="text-[10px] font-mono text-[#3fb950] uppercase px-4 py-1 bg-[#3fb950]/10 rounded-full border border-[#3fb950]/20 italic">
               {results.personalYear === 4 ? "STRUCTURAL_BUILD" : "STRATEGIC_SHIFT"}
            </div>
          </div>
        </div>

        {/* 2. æ ¸å¿ƒå…¨æ¯å±•ç¤ºåŒº */}
        <div id="report-content" className="grid grid-cols-1 lg:grid-cols-12 gap-6 items-stretch">
          
          {/* å·¦ï¼šé‡åŒ–æ‘˜è¦ */}
          <div className="lg:col-span-4 flex flex-col gap-6">
            <div className="bg-[#161b22] p-8 rounded-[2rem] border border-[#30363d] shadow-xl print:bg-white print:border-slate-300 print:text-black">
               <div className="flex items-center gap-4 mb-8 pb-6 border-b border-[#30363d] print:border-slate-200">
                 <div className={`w-14 h-14 rounded-2xl bg-[#0d1117] flex items-center justify-center border border-[#30363d]`}>
                   {profile.gender === 'Male' ? <Mars className="text-[#58a6ff]" size={28}/> : <Venus className="text-[#f85149]" size={28}/>}
                 </div>
                 <div className="flex-1">
                    {isEditingName ? <input type="text" value={profile.name} onChange={(e) => setProfile({...profile, name: e.target.value})} onBlur={() => setIsEditingName(false)} className="bg-black border border-[#58a6ff] rounded px-2 py-1 text-lg font-black text-white w-full outline-none" autoFocus /> : <h2 className="text-2xl font-black tracking-tight print:text-black">{profile.name}</h2>}
                    <p className="text-[9px] text-[#8b949e] font-mono uppercase mt-1 tracking-widest leading-none flex items-center gap-1">
                      <Hash size={10}/> BRANCH: MAIN / ID: 0930
                    </p>
                 </div>
               </div>
               <div className="space-y-5">
                  {results.metrics.map((m, idx) => (
                    <div key={idx} className="space-y-1.5">
                       <div className="flex justify-between items-center text-[10px] font-bold">
                          <div className="flex items-center gap-2">
                             <m.icon size={12} className="text-[#8b949e]"/>
                             <span className="text-[#8b949e] uppercase tracking-tighter">{m.label}</span>
                          </div>
                          <span className="text-white font-mono print:text-black">{m.val}%</span>
                       </div>
                       <div className="h-1.5 w-full bg-[#0d1117] rounded-full overflow-hidden border border-[#30363d] print:bg-slate-100">
                          <div className="h-full transition-all duration-1000" style={{ width: `${m.val}%`, backgroundColor: m.color }}></div>
                       </div>
                    </div>
                  ))}
               </div>
               
               {/* Money Balancing Module */}
               <div className="mt-10 p-4 bg-[#0d1117] rounded-xl border border-rose-500/20 print:bg-slate-50">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-[9px] font-black text-rose-400 uppercase flex items-center gap-2"><Heart size={10}/> Noise Filter: Money</span>
                    <span className="text-[9px] font-mono text-rose-300">STABLE</span>
                  </div>
                  <div className="flex gap-1">
                    {Array.from({ length: 12 }).map((_, i) => (
                      <div key={i} className={`h-4 flex-1 rounded-sm ${i < 10 ? 'bg-rose-500/40' : 'bg-[#161b22]'}`}></div>
                    ))}
                  </div>
                  <p className="text-[9px] text-[#8b949e] mt-2 italic text-center uppercase tracking-tighter">"Frequency Anchor for 3-9-4 Model"</p>
               </div>
            </div>

            {/* GitHub é£æ ¼ä»£ç æ¨å¯¼ */}
            <div className="bg-[#161b22] p-6 rounded-2xl border border-[#30363d] print:bg-slate-50">
               <h3 className="text-[10px] font-black text-[#58a6ff] uppercase tracking-widest mb-4 flex items-center gap-2"><Code2 size={14}/> Life-Source.js</h3>
               <pre className="text-[11px] font-mono leading-[1.6] text-[#c9d1d9] bg-[#0d1117] p-4 rounded-xl border border-[#30363d] overflow-x-auto print:text-black">
                 <code className="text-[#79c0ff]">const</code> <code className="text-[#d2a8ff]">LifeMatrix</code> = {"{\n"}
                 {"  "}main_node: <code className="text-[#ff7b72]">{results.F}</code>, <code className="text-[#8b949e]">// 3å·äºº</code>{"\n"}
                 {"  "}base_sitting: <code className="text-[#ff7b72]">{results.K}</code>, <code className="text-[#8b949e]">// åé•‡</code>{"\n"}
                 {"  "}current_flow: <code className="text-[#ff7b72]">{results.personalYear}</code>,{"\n"}
                 {"  "}blueprint: <code className="text-[#a5d6ff]">"REFACTOR_2026"</code>{"\n"}
                 {"}"};
               </pre>
            </div>
          </div>

          {/* å³ï¼šå…«è§’é›·è¾¾ä¸çƒ­åŠ›å›¾ (ç¾åŒ–ç‰ˆ) */}
          <div className="lg:col-span-8 bg-[#161b22] p-8 rounded-[2.5rem] border border-[#30363d] flex flex-col items-center justify-center relative print:bg-white print:border-slate-300">
             
             <div className="relative w-[500px] h-[500px] flex items-center justify-center">
               <svg className="absolute inset-0 w-full h-full overflow-visible" viewBox="0 0 100 100">
                 <defs>
                    <radialGradient id="radarGlow" cx="50%" cy="50%" r="50%">
                       <stop offset="0%" stopColor="#388bfd" stopOpacity="0.25" />
                       <stop offset="100%" stopColor="#388bfd" stopOpacity="0" />
                    </radialGradient>
                    <linearGradient id="edgeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                       <stop offset="0%" stopColor="#58a6ff" />
                       <stop offset="100%" stopColor="#3fb950" />
                    </linearGradient>
                 </defs>
                 <circle cx="50" cy="50" r="45" fill="url(#radarGlow)" className="animate-pulse" />
                 {[0.2, 0.4, 0.6, 0.8, 1.0].map(s => (
                    <polygon key={s} points={getOctagonPoints(50, 50, 45 * s)} fill="none" stroke="#30363d" strokeWidth="0.15" />
                 ))}
                 {Array.from({ length: 8 }).map((_, i) => {
                    const a = (i * 45 - 90) * (Math.PI / 180);
                    return <line key={i} x1="50" y1="50" x2={50 + 45 * Math.cos(a)} y2={50 + 45 * Math.sin(a)} stroke="#30363d" strokeWidth="0.1" />;
                 })}
                 <polygon points={getRadarPoints(50, 50, 45, results.metrics)} fill="url(#edgeGrad)" fillOpacity="0.2" stroke="url(#edgeGrad)" strokeWidth="1.5" className="transition-all duration-1000" />
               </svg>

               <div className="absolute z-50">
                  <div className={`w-36 h-36 rounded-[3.5rem] bg-[#0d1117] flex flex-col items-center justify-center text-white border-4 border-[#30363d] shadow-2xl print:bg-white print:text-black print:border-black`}>
                    <span className="text-[11px] font-mono text-[#8b949e] mb-1">MAIN_TRAIT</span>
                    <span className="text-7xl font-black leading-none tracking-tighter">{results.F}</span>
                    <div className="h-0.5 w-12 bg-[#238636] my-2"></div>
                    <span className="text-[10px] font-bold text-[#58a6ff] tracking-widest uppercase">Apex.run()</span>
                  </div>
               </div>

               {results.metrics.map((m, i) => {
                 const a = (i * 45 - 90) * (Math.PI / 180);
                 const x = 50 + 58 * Math.cos(a);
                 const y = 50 + 58 * Math.sin(a);
                 return (
                   <div key={i} className="absolute flex flex-col items-center transform -translate-x-1/2 -translate-y-1/2" style={{ left: `${x}%`, top: `${y}%` }}>
                     <div className="bg-[#161b22]/90 backdrop-blur-md border border-[#30363d] px-3 py-1.5 rounded-lg flex items-center gap-2 shadow-2xl print:bg-slate-50 print:border-slate-200">
                        <m.icon size={10} style={{ color: m.color }}/>
                        <span className="text-[9px] font-black text-white uppercase tracking-tighter print:text-black">{m.label}</span>
                        <span className="text-[10px] font-mono text-[#8b949e]">{m.val}</span>
                     </div>
                   </div>
                 );
               })}
             </div>

             {/* GitHub Heatmap - æˆ˜ç•¥è´¡çŒ®å›¾ */}
             <div className="mt-24 w-full pt-10 border-t border-[#30363d] print:border-slate-200">
                <div className="flex justify-between items-end mb-4">
                  <h4 className="text-[11px] font-black text-white uppercase tracking-widest flex items-center gap-2 print:text-black"><Layout size={14} className="text-[#3fb950]"/> Strategic Intensity Heatmap</h4>
                  <div className="flex gap-1 items-center no-print">
                    <span className="text-[8px] text-[#8b949e]">Cold</span>
                    {[0, 1, 2, 3, 4].map(v => <div key={v} className={`w-3 h-3 rounded-sm ${['bg-[#161b22]', 'bg-[#0e4429]', 'bg-[#006d32]', 'bg-[#26a641]', 'bg-[#39d353]'][v]}`}></div>)}
                    <span className="text-[8px] text-[#8b949e]">Peak</span>
                  </div>
                </div>
                <div className="grid grid-cols-[repeat(26,1fr)] gap-1.5 overflow-hidden">
                   {Array.from({ length: 26 * 7 }).map((_, i) => {
                      const seed = Math.random();
                      const level = seed > 0.95 ? "bg-[#39d353]" : seed > 0.8 ? "bg-[#26a641]" : seed > 0.6 ? "bg-[#006d32]" : seed > 0.3 ? "bg-[#0e4429]" : "bg-[#161b22]";
                      return <div key={i} className={`aspect-square rounded-[2px] ${level} hover:ring-1 hover:ring-white transition-all`}></div>;
                   })}
                </div>
             </div>
          </div>
        </div>

        {/* æˆ˜ç•¥ Log æŠ¥å‘ŠåŒºåŸŸ */}
        <div className="flex flex-col gap-6 no-print">
           <div className="flex justify-between items-center">
              <h3 className="text-[10px] font-bold text-[#8b949e] uppercase tracking-[0.4em] flex items-center gap-2"><Activity size={14} className="text-[#58a6ff]"/> Strategic Log Analysis</h3>
              <button onClick={handleAiAnalyze} disabled={aiLoading} className="px-8 py-3 bg-[#238636] hover:bg-[#2ea44f] text-white rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 shadow-xl transition-all active:scale-95">
                {aiLoading ? <Loader2 className="animate-spin" size={16}/> : <Terminal size={16}/>} Compile Report
              </button>
           </div>
           {aiResponse && (
             <div className="bg-[#161b22] p-10 rounded-[2.5rem] border border-[#30363d] shadow-2xl print:bg-white print:border-slate-300 print:text-black">
                <div className="text-[14px] text-[#c9d1d9] leading-[1.9] border-l-4 border-[#30363d] pl-8 print:text-slate-800 print:border-[#388bfd] font-mono whitespace-pre-wrap print:font-sans">
                   {aiResponse}
                </div>
             </div>
           )}
        </div>

        {/* åº•éƒ¨è¾“å…¥ç»ˆç«¯ */}
        <div className="bg-[#0d1117] p-8 rounded-[3rem] border border-[#30363d] shadow-2xl no-print">
          <div className="flex gap-4">
            <span className="text-[#58a6ff] font-bold mt-4">$</span>
            <input 
              type="text" 
              value={chatInput}
              onChange={(e) => setChatInput(e.target.value)}
              placeholder="è¾“å…¥æŸ¥è¯¢æŒ‡ä»¤..."
              className="flex-grow bg-transparent border-none py-4 text-sm font-mono text-white focus:ring-0 outline-none"
              onKeyDown={(e) => e.key === 'Enter' && handleChat()}
            />
            <button onClick={handleChat} disabled={aiLoading || !chatInput.trim()} className="px-10 bg-[#21262d] hover:bg-[#30363d] border border-[#30363d] text-white rounded-xl font-bold text-xs uppercase tracking-widest transition-all">
              {aiLoading ? <Loader2 className="animate-spin" size={18} /> : 'RUN'}
            </button>
          </div>
        </div>
      </div>
      
      <style>{`
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 12s linear infinite; }
        @media print {
          body { background-color: white !important; color: black !important; padding: 0 !important; }
          .no-print { display: none !important; }
          .only-print { display: block !important; }
          .min-h-screen { min-height: auto !important; background: white !important; padding: 0 !important; }
          .max-w-6xl { max-width: 100% !important; margin: 0 !important; padding: 15px !important; }
          #report-content { display: grid !important; }
          svg polygon, svg line { stroke: #000 !important; opacity: 0.3 !important; }
          page-break-inside: avoid;
        }
        .only-print { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }
      `}</style>
    </div>
  );
};

export default App;
