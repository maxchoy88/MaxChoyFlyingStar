/**
 * @file LifeCodeApp.jsx
 * @version 4.3 (GitHub Unicode Optimized)
 * @description æˆ˜ç•¥çº§ç”Ÿå‘½å…¨æ¯ç»ˆç«¯ - ä¹±ç é˜²å¾¡å¢å¼ºç‰ˆ
 * @author Bo (AI Strategist) for Castor (é˜¿ç››)
 * * æ³¨æ„ï¼šå¦‚æœä¸Šä¼  GitHub åä»è§ä¹±ç ï¼Œè¯·åœ¨ç¼–è¾‘å™¨ä¸­é€‰æ‹© "Save with Encoding -> UTF-8"ã€‚
 */

import React, { useState, useEffect, useMemo } from 'react';
import { 
  Zap, Shield, User, Heart, TrendingUp, 
  Crown, Compass, Briefcase, Share2, 
  Calculator, Sparkles, MessageSquare, Loader2, RefreshCw, 
  BarChart3, Settings, UserPlus, Info, Calendar,
  LineChart, Target, Edit3, Mars, Venus, Printer, MessageCircle,
  FileText, Activity, Hash, Binary, ChevronRight, Layout,
  PackageCheck, Hexagon, Gauge, Terminal,
  Code2, GitBranch, Github, Boxes, Workflow, Database, Search,
  Globe as LucideGlobe, Anchor as LucideAnchor
} from 'lucide-react';

// --- é¢„å®šä¹‰å›¾æ ‡ç»„ä»¶ (é˜²æ­¢åˆå§‹åŒ–é¡ºåºæŠ¥é”™) ---
const GlobeIcon = (props) => <LucideGlobe {...props} />;
const AnchorIcon = (props) => <LucideAnchor {...props} />;

const App = () => {
  // --- æ ¸å¿ƒè®¡ç®—å¼•æ“ (Pythagorean Formula) ---
  const reduceNum = (n) => {
    if (!n) return 0;
    let num = Math.abs(parseInt(n));
    while (num > 9) {
      num = String(num).split('').reduce((acc, curr) => acc + parseInt(curr), 0);
    }
    return num;
  };

  const calculateFullMatrix = (y, m, d, analysisYear) => {
    const dStr = String(d).padStart(2, '0');
    const mStr = String(m).padStart(2, '0');
    const yStr = String(y);
    
    const d1 = parseInt(dStr[0]) || 0; const d2 = parseInt(dStr[1]) || 0;
    const m1 = parseInt(mStr[0]) || 0; const m2 = parseInt(mStr[1]) || 0;
    const yr1 = parseInt(yStr[0]) || 0; const yr2 = parseInt(yStr[1]) || 0;
    const yr3 = parseInt(yStr[2]) || 0; const yr4 = parseInt(yStr[3]) || 0;

    const A = reduceNum(d1 + d2); 
    const B = reduceNum(m1 + m2); 
    const C = reduceNum(reduceNum(yr1 + yr2) + reduceNum(yr3 + yr4)); 
    const D = reduceNum(A + B); 
    const E = reduceNum(B + C); 
    const F = reduceNum(D + E); 
    const G = reduceNum(A + D); 
    const H = reduceNum(C + E); 
    const I = reduceNum(D + F); 
    const J = reduceNum(E + F); 
    const K = reduceNum(I + J); 

    const personalYear = reduceNum(parseInt(analysisYear) + reduceNum(m) + reduceNum(d));

    // æ•°æ®åŒ–è¯„åˆ†æŒ‡æ ‡
    const metrics = [
      { label: 'æ‰§è¡Œé€Ÿåº¦', val: A * 11, color: '#f85149', icon: Zap },
      { label: 'æˆ˜ç•¥é€»è¾‘', val: D * 11, color: '#388bfd', icon: Workflow },
      { label: 'æ ¸å¿ƒèƒ½é‡', val: F * 11, color: '#79c0ff', icon: Crown },
      { label: 'ç¯å¢ƒé€‚åº”', val: C * 11, color: '#3fb950', icon: GlobeIcon },
      { label: 'ç›´è§‰æ•é”', val: B * 11, color: '#d2a8ff', icon: Heart },
      { label: 'é£é™©æ§åˆ¶', val: personalYear === 4 ? 96 : 45, color: '#ffa657', icon: Shield },
      { label: 'æœªæ¥å¢ç›Š', val: H * 11, color: '#a371f7', icon: TrendingUp },
      { label: 'åé•‡åº•è•´', val: K * 11, color: '#ff7b72', icon: AnchorIcon }
    ];

    return { A, B, C, D, E, F, G, H, I, J, K, personalYear, metrics };
  };

  // --- çŠ¶æ€ç®¡ç† ---
  const [profile, setProfile] = useState({
    name: 'Castor é˜¿ç››',
    gender: 'Male',
    birthYear: 1980,
    birthMonth: 9,
    birthDay: 30,
    targetYear: 2026 
  });
  
  const [isEditingName, setIsEditingName] = useState(false);
  const [aiLoading, setAiLoading] = useState(false);
  const [aiResponse, setAiResponse] = useState('');
  const [chatInput, setChatInput] = useState('');

  const results = useMemo(() => {
    return calculateFullMatrix(profile.birthYear, profile.birthMonth, profile.birthDay, profile.targetYear);
  }, [profile.birthYear, profile.birthMonth, profile.birthDay, profile.targetYear]);

  const flowYears = [2024, 2025, 2026, 2027, 2028, 2029, 2030];
  const birthYears = Array.from({ length: 81 }, (_, i) => 1950 + i);
  const months = Array.from({ length: 12 }, (_, i) => i + 1);
  const days = Array.from({ length: 31 }, (_, i) => i + 1);

  // --- æ¸²æŸ“è¾…åŠ© ---
  const getOctagonPoints = (cx, cy, r) => {
    let pts = [];
    for (let i = 0; i < 8; i++) {
      let angle = (i * 45 - 90) * (Math.PI / 180);
      pts.push(`${cx + r * Math.cos(angle)},${cy + r * Math.sin(angle)}`);
    }
    return pts.join(' ');
  };

  const getRadarPoints = (cx, cy, maxR, metrics) => {
    let pts = [];
    metrics.forEach((m, i) => {
      let r = (m.val / 100) * maxR;
      let angle = (i * 45 - 90) * (Math.PI / 180);
      pts.push(`${cx + r * Math.cos(angle)},${cy + r * Math.sin(angle)}`);
    });
    return pts.join(' ');
  };

  // --- AI é€»è¾‘ ---
  const callGemini = async (prompt, systemPrompt = "") => {
    setAiLoading(true);
    const apiKey = ""; 
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
    try {
      const response = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }],
          systemInstruction: { parts: [{ text: systemPrompt }] }
        })
      });
      const data = await response.json();
      const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
      // å¼ºåˆ¶è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œé˜²å¾¡å¯¹è±¡æ¸²æŸ“é”™è¯¯
      setAiResponse(typeof text === 'object' ? JSON.stringify(text) : String(text || ""));
    } catch (err) { 
      setAiResponse(`[FATAL_ERROR]: ${err.message}`); 
    } finally { 
      setAiLoading(false); 
    }
  };

  const handleChat = () => {
    if (!chatInput.trim() || !results) return;
    const prompt = `[QUERY]: ${chatInput}. Context: Main ${results.F}, Root ${results.K}, PersonalYear ${results.personalYear}. Mode: Trader & Coach.`;
    callGemini(prompt, "ä½ æ˜¯ä¸€ä½é¡¶å°–å•†ä¸šæˆ˜ç•¥é¡¾é—®æ³¢(Bo)ã€‚è¯·ç”¨æ•´é½ä¸”å¯Œæœ‰æ´å¯ŸåŠ›çš„ä¸­æ–‡å›ç­”ã€‚");
    setChatInput('');
  };

  const handleAiAnalyze = () => {
    const prompt = `åˆ†æ 1980-09-30 åºšç”³å¹´ç”·æ€§å‘½ç›˜ã€‚ä¸»å‘½ ${results.F}ã€‚é‡ç‚¹è¯´æ˜å…¶åœ¨ 2026 æ¶æ„å¹´(4) å¯¹ U13 è¶³çƒé¡¹ç›®çš„ç®¡ç†å»ºè®®ã€‚åˆ†æå…¶å® ç‰© Money (ç‹¸èŠ±çŒ«) å¦‚ä½•é€šè¿‡ç¨³æ€é¢‘ç‡å¹³è¡¡ 3 å·ç›´è§‰å¸¦æ¥çš„é«˜é¢‘å‹åŠ›ã€‚`;
    callGemini(prompt, "è¯·æä¾›ä¸€ä»½å¸¦æœ‰ä»£ç å—é£æ ¼å’Œ Git Log é£æ ¼çš„ä¸­æ–‡æˆ˜ç•¥åˆ†ææŠ¥å‘Šã€‚");
  };

  const handleWhatsAppShare = () => {
    const message = encodeURIComponent(
      `ğŸ“Š *CASTOR STRATEGIC BLUEPRINT v4.3*\n` +
      `------------------------------------\n` +
      `ğŸ‘¤ å¯¹è±¡: ${profile.name}\n` +
      `ğŸ”¢ ä¸»å‘½æ•°: ${results.F} | åé•‡: ${results.K}\n` +
      `âš¡ 2026æµå¹´: ${results.personalYear} (æ¶æ„å¹´)\n` +
      `ğŸ± æƒ…ç»ªå¯¹å†²: Money (ç‹¸èŠ±çŒ«) æ¨¡å¼å·²å¼€å¯\n` +
      `------------------------------------\n` +
      `>>> è¯¦ç»†é‡åŒ–æŠ¥å‘Šè¯·æŸ¥çœ‹éšé™„ PDF è“å›¾ã€‚`
    );
    window.open(`https://wa.me/?text=${message}`, '_blank');
  };

  return (
    <div className="min-h-screen bg-[#0d1117] text-[#c9d1d9] p-4 md:p-8 font-sans selection:bg-[#238636] selection:text-white antialiased">
      <div className="max-w-6xl mx-auto flex flex-col gap-6">
        
        {/* Header - GitHub Pro Style */}
        <div className="flex justify-between items-center border-b border-[#30363d] pb-6 no-print">
          <div className="flex items-center gap-4">
            <div className="p-3 bg-[#161b22] border border-[#30363d] rounded-xl text-[#58a6ff] shadow-inner">
              <Github size={28} />
            </div>
            <div>
              <div className="flex items-center gap-2">
                <h1 className="text-xl font-bold text-white tracking-tight">castor-life-matrix-v4.3</h1>
                <span className="text-[10px] font-bold border border-[#238636] px-2 py-0.5 rounded-full text-[#3fb950] bg-[#238636]/10 uppercase">Stable</span>
              </div>
              <p className="text-xs text-[#8b949e] font-mono mt-1 flex items-center gap-2 uppercase tracking-tighter italic">
                <GitBranch size={12}/> origin / castor-intelligence-core
              </p>
            </div>
          </div>
          <div className="flex gap-3">
             <button onClick={handleWhatsAppShare} className="group flex items-center gap-2 px-4 py-2 bg-[#21262d] border border-[#30363d] rounded-lg text-sm font-semibold hover:border-[#8b949e] transition-all">
              <MessageCircle size={16} className="text-[#3fb950] group-hover:scale-110 transition-transform"/> <span className="hidden sm:inline">WhatsApp Share</span>
            </button>
            <button onClick={() => window.print()} className="flex items-center gap-2 px-4 py-2 bg-[#238636] border border-[#2ea44f] text-white rounded-lg text-sm font-semibold hover:bg-[#2ea44f] transition-all shadow-md">
              <Printer size={16} /> Export PDF
            </button>
            <button onClick={() => setIsEditingName(!isEditingName)} className="p-2.5 bg-[#21262d] border border-[#30363d] rounded-lg text-[#8b949e] hover:text-white transition-colors">
              <Edit3 size={18} />
            </button>
          </div>
        </div>

        {/* æ‰“å°ä¸“ç”¨ */}
        <div className="hidden only-print text-center border-b-2 border-black pb-10 mb-12">
          <h1 className="text-3xl font-black text-black uppercase tracking-widest">é˜¿ç›› (Castor) å…¨ç›¸ä½æˆ˜ç•¥é‡åŒ–æŠ¥å‘Š</h1>
          <p className="text-sm font-mono mt-2 text-slate-600 italic">"Algorithmic Approach to Personal Flow & Decision Logic"</p>
        </div>

        {/* 1. æ§åˆ¶å°é…ç½®é¢æ¿ */}
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 no-print">
          <div className="lg:col-span-8 bg-[#161b22] p-6 rounded-2xl border border-[#30363d] shadow-sm">
             <div className="flex justify-between items-center mb-6">
                <div className="flex items-center gap-2 text-white font-bold text-xs uppercase tracking-widest"><Terminal size={14} className="text-[#8b949e]"/> BIOS Config</div>
                <div className="flex bg-[#0d1117] p-1 rounded-lg border border-[#30363d]">
                  <button onClick={() => setProfile({...profile, gender: 'Male'})} className={`px-4 py-1.5 rounded-md text-[10px] font-bold transition-all ${profile.gender === 'Male' ? 'bg-[#388bfd] text-white shadow-lg' : 'text-[#8b949e]'}`}>MALE</button>
                  <button onClick={() => setProfile({...profile, gender: 'Female'})} className={`px-4 py-1.5 rounded-md text-[10px] font-bold transition-all ${profile.gender === 'Female' ? 'bg-[#f85149] text-white shadow-lg' : 'text-[#8b949e]'}`}>FEMALE</button>
                </div>
             </div>
             <div className="grid grid-cols-3 gap-4 mb-6">
                {['YEAR', 'MONTH', 'DAY'].map((label, i) => (
                  <div key={label} className="space-y-1">
                    <span className="text-[9px] text-[#8b949e] font-bold ml-1 uppercase">{label}</span>
                    <select 
                      value={profile[i === 0 ? 'birthYear' : i === 1 ? 'birthMonth' : 'birthDay']} 
                      onChange={(e) => setProfile({...profile, [i === 0 ? 'birthYear' : i === 1 ? 'birthMonth' : 'birthDay']: parseInt(e.target.value)})} 
                      className="w-full bg-[#0d1117] border border-[#30363d] rounded-xl p-3 text-sm font-black text-white focus:border-[#58a6ff] outline-none hover:bg-[#1c2128] transition-colors"
                    >
                      {[birthYears, months, days][i].map(o => <option key={o} value={o}>{o}</option>)}
                    </select>
                  </div>
                ))}
             </div>
             <div className="pt-4 border-t border-[#30363d]">
                <div className="flex gap-2 overflow-x-auto no-scrollbar py-1">
                  {flowYears.map(y => (
                    <button key={y} onClick={() => setProfile({...profile, targetYear: y})} className={`shrink-0 px-5 py-2.5 rounded-xl text-xs font-black transition-all border ${profile.targetYear === y ? 'bg-[#388bfd]/20 border-[#388bfd] text-[#58a6ff]' : 'bg-[#0d1117] border-[#30363d] text-[#8b949e]'}`}>{y}</button>
                  ))}
                </div>
             </div>
          </div>
          <div className="lg:col-span-4 bg-[#161b22] p-6 rounded-2xl border border-[#30363d] flex flex-col justify-center items-center text-center">
            <span className="text-[10px] font-bold text-[#8b949e] uppercase mb-2 tracking-widest">Flow Commit Density</span>
            <div className="text-7xl font-black text-[#3fb950] tracking-tighter mb-2 drop-shadow-[0_0_15px_rgba(63,185,80,0.3)]">{results.personalYear}</div>
            <div className="text-[10px] font-mono text-[#3fb950] uppercase px-4 py-1 bg-[#3fb950]/10 rounded-full border border-[#3fb950]/20">
               {results.personalYear === 4 ? "Architectural Lock" : "Strategic Jump"}
            </div>
          </div>
        </div>

        {/* 2. æ ¸å¿ƒå…¨æ¯æŠ¥å‘Š */}
        <div id="report-content" className="grid grid-cols-1 lg:grid-cols-12 gap-6 items-stretch">
          
          {/* å·¦ï¼šé‡åŒ–æ•°æ®é¢æ¿ */}
          <div className="lg:col-span-4 flex flex-col gap-6">
            <div className="bg-[#161b22] p-8 rounded-[2rem] border border-[#30363d] shadow-xl print:bg-white print:border-slate-300 print:text-black">
               <div className="flex items-center gap-4 mb-8 pb-6 border-b border-[#30363d] print:border-slate-200">
                 <div className={`w-14 h-14 rounded-2xl bg-[#0d1117] flex items-center justify-center border border-[#30363d] print:bg-slate-50`}>
                   {profile.gender === 'Male' ? <Mars className="text-[#58a6ff]" size={28}/> : <Venus className="text-[#f85149]" size={28}/>}
                 </div>
                 <div className="flex-1">
                    {isEditingName ? <input type="text" value={profile.name} onChange={(e) => setProfile({...profile, name: e.target.value})} onBlur={() => setIsEditingName(false)} className="bg-black border border-[#58a6ff] rounded px-2 py-1 text-lg font-black text-white w-full outline-none" autoFocus /> : <h2 className="text-2xl font-black tracking-tight print:text-black">{profile.name}</h2>}
                    <p className="text-[9px] text-[#8b949e] font-mono uppercase mt-1 tracking-widest leading-none flex items-center gap-1">
                      <Search size={10}/> GENG-SHEN 0930 | MAIN BRANCH
                    </p>
                 </div>
               </div>
               <div className="space-y-5">
                  {results.metrics.map((m, idx) => (
                    <div key={idx} className="space-y-1.5">
                       <div className="flex justify-between items-center text-[10px] font-bold uppercase">
                          <div className="flex items-center gap-2">
                             <m.icon size={12} style={{ color: m.color }}/>
                             <span className="text-[#8b949e]">{m.label}</span>
                          </div>
                          <span className="text-white font-mono print:text-black">{m.val}%</span>
                       </div>
                       <div className="h-1.5 w-full bg-[#0d1117] rounded-full overflow-hidden border border-[#30363d] print:bg-slate-100">
                          <div className="h-full transition-all duration-1000" style={{ width: `${m.val}%`, backgroundColor: m.color }}></div>
                       </div>
                    </div>
                  ))}
               </div>
               
               {/* Money Stability Buffer */}
               <div className="mt-10 p-5 bg-[#0d1117] rounded-xl border border-rose-500/20 print:bg-slate-50">
                  <div className="flex justify-between items-center mb-3">
                    <span className="text-[9px] font-black text-rose-400 uppercase flex items-center gap-2"><Heart size={10}/> Noise Reduction: Money</span>
                    <span className="text-[9px] font-mono text-rose-300">ACTIVE</span>
                  </div>
                  <div className="flex gap-1">
                    {Array.from({ length: 12 }).map((_, i) => (
                      <div key={i} className={`h-4 flex-1 rounded-sm ${i < 10 ? 'bg-rose-500/30' : 'bg-[#161b22]'} animate-pulse`}></div>
                    ))}
                  </div>
                  <p className="text-[9px] text-[#8b949e] mt-3 italic text-center uppercase tracking-tighter">"Stability Frequency for 3-9-4 Execution"</p>
               </div>
            </div>

            {/* ä»£ç åŒ–æ¨å¯¼ Logic Panel */}
            <div className="bg-[#161b22] p-6 rounded-2xl border border-[#30363d] print:bg-slate-50">
               <div className="flex items-center gap-2 mb-4">
                  <Code2 size={14} className="text-[#58a6ff]"/>
                  <span className="text-[10px] font-black text-[#58a6ff] uppercase tracking-widest">source_deduction.js</span>
               </div>
               <pre className="text-[11px] font-mono leading-[1.7] text-[#c9d1d9] bg-[#0d1117] p-4 rounded-xl border border-[#30363d] overflow-x-auto print:text-black">
                 <code className="text-[#79c0ff]">const</code> <code className="text-[#d2a8ff]">Matrix</code> = {"{\n"}
                 {"  "}apex: <code className="text-[#ff7b72]">{results.F}</code>, <code className="text-[#8b949e]">// 3å·è¡ŒåŠ¨æ ¸å¿ƒ</code>{"\n"}
                 {"  "}base: <code className="text-[#ff7b72]">{results.K}</code>, <code className="text-[#8b949e]">// 9å·åé•‡æ„¿æ™¯</code>{"\n"}
                 {"  "}year: <code className="text-[#ff7b72]">{results.personalYear}</code>, <code className="text-[#8b949e]">// 2026 æ¶æ„å¹´</code>{"\n"}
                 {"  "}status: <code className="text-[#a5d6ff]">"SYSTEM_REFACTOR"</code>{"\n"}
                 {"}"};
               </pre>
            </div>
          </div>

          {/* å³ï¼šGlowing Radar & Heatmap */}
          <div className="lg:col-span-8 bg-[#161b22] p-10 rounded-[2.5rem] border border-[#30363d] flex flex-col items-center justify-center relative print:bg-white print:border-slate-300">
             
             {/* å…«è§’æ•°æ®ç½—ç›˜ */}
             <div className="relative w-[520px] h-[520px] flex items-center justify-center">
               <svg className="absolute inset-0 w-full h-full overflow-visible" viewBox="0 0 100 100">
                 <defs>
                    <radialGradient id="radarGlow" cx="50%" cy="50%" r="50%">
                       <stop offset="0%" stopColor="#388bfd" stopOpacity="0.3" />
                       <stop offset="100%" stopColor="#388bfd" stopOpacity="0" />
                    </radialGradient>
                    <linearGradient id="edgeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                       <stop offset="0%" stopColor="#58a6ff" />
                       <stop offset="100%" stopColor="#3fb950" />
                    </linearGradient>
                 </defs>
                 <circle cx="50" cy="50" r="45" fill="url(#radarGlow)" className="animate-pulse" />
                 {[0.2, 0.4, 0.6, 0.8, 1.0].map(s => (
                    <polygon key={s} points={getOctagonPoints(50, 50, 45 * s)} fill="none" stroke="#30363d" strokeWidth="0.1" />
                 ))}
                 {Array.from({ length: 8 }).map((_, i) => {
                    const a = (i * 45 - 90) * (Math.PI / 180);
                    return <line key={i} x1="50" y1="50" x2={50 + 45 * Math.cos(a)} y2={50 + 45 * Math.sin(a)} stroke="#30363d" strokeWidth="0.1" />;
                 })}
                 <polygon points={getRadarPoints(50, 50, 45, results.metrics)} fill="url(#edgeGrad)" fillOpacity="0.25" stroke="url(#edgeGrad)" strokeWidth="2" className="transition-all duration-1000" />
                 {results.metrics.map((m, i) => {
                    const a = (i * 45 - 90) * (Math.PI / 180);
                    const r = (m.val / 100) * 45;
                    return <circle key={i} cx={50 + r * Math.cos(a)} cy={50 + r * Math.sin(a)} r="1" fill={m.color} className="animate-bounce-slow" />;
                 })}
               </svg>

               <div className="absolute z-50">
                  <div className={`w-36 h-36 rounded-[3.5rem] bg-[#0d1117] flex flex-col items-center justify-center text-white border-4 border-[#30363d] shadow-2xl print:bg-white print:text-black print:border-black`}>
                    <span className="text-[11px] font-mono text-[#8b949e] mb-1">NODE_ID</span>
                    <span className="text-7xl font-black leading-none tracking-tighter">{results.F}</span>
                    <div className="h-0.5 w-12 bg-[#238636] my-2"></div>
                    <span className="text-[10px] font-bold text-[#58a6ff] tracking-widest uppercase">Apex_Run</span>
                  </div>
               </div>

               {/* æ ‡ç­¾ */}
               {results.metrics.map((m, i) => {
                 const a = (i * 45 - 90) * (Math.PI / 180);
                 const x = 50 + 58 * Math.cos(a);
                 const y = 50 + 58 * Math.sin(a);
                 return (
                   <div key={i} className="absolute flex flex-col items-center transform -translate-x-1/2 -translate-y-1/2" style={{ left: `${x}%`, top: `${y}%` }}>
                     <div className="bg-[#161b22]/95 backdrop-blur-md border border-[#30363d] px-3 py-1.5 rounded-lg flex items-center gap-2 shadow-2xl print:bg-slate-50 print:border-slate-200">
                        <m.icon size={10} style={{ color: m.color }}/>
                        <span className="text-[9px] font-black text-white uppercase tracking-tighter print:text-black">{m.label}</span>
                        <span className="text-[10px] font-mono text-[#8b949e]">{m.val}</span>
                     </div>
                   </div>
                 );
               })}
             </div>

             {/* GitHub Heatmap - æˆ˜ç•¥æ´»è·ƒåº¦ */}
             <div className="mt-20 w-full pt-10 border-t border-[#30363d] print:border-slate-200">
                <div className="flex justify-between items-end mb-4">
                  <h4 className="text-[11px] font-black text-white uppercase tracking-widest flex items-center gap-2 print:text-black"><Layout size={14} className="text-[#3fb950]"/> Strategic Intensity Heatmap</h4>
                  <div className="flex gap-1 items-center no-print">
                    <span className="text-[8px] text-[#8b949e]">Cold</span>
                    {[0, 1, 2, 3, 4].map(v => <div key={v} className={`w-3 h-3 rounded-sm ${['bg-[#161b22]', 'bg-[#0e4429]', 'bg-[#006d32]', 'bg-[#26a641]', 'bg-[#39d353]'][v]}`}></div>)}
                    <span className="text-[8px] text-[#8b949e]">Peak</span>
                  </div>
                </div>
                <div className="grid grid-cols-[repeat(26,1fr)] gap-1.5 overflow-hidden">
                   {Array.from({ length: 26 * 7 }).map((_, i) => {
                      const seed = Math.random();
                      const level = seed > 0.94 ? "bg-[#39d353]" : seed > 0.8 ? "bg-[#26a641]" : seed > 0.6 ? "bg-[#006d32]" : seed > 0.3 ? "bg-[#0e4429]" : "bg-[#161b22]";
                      return <div key={i} className={`aspect-square rounded-[2px] ${level} hover:ring-1 hover:ring-white transition-all`}></div>;
                   })}
                </div>
             </div>
          </div>
        </div>

        {/* æˆ˜ç•¥ Log æŠ¥å‘Š */}
        <div className="flex flex-col gap-6 no-print">
           <div className="flex justify-between items-center px-2">
              <h3 className="text-[10px] font-bold text-[#8b949e] uppercase tracking-[0.4em] flex items-center gap-2"><Activity size={14} className="text-[#58a6ff]"/> Git Strategic Log</h3>
              <button onClick={handleAiAnalyze} disabled={aiLoading} className="px-8 py-3 bg-[#238636] hover:bg-[#2ea44f] text-white rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 shadow-xl transition-all active:scale-95">
                {aiLoading ? <Loader2 className="animate-spin" size={16}/> : <Terminal size={16}/>} Compile Final Report
              </button>
           </div>
           {aiResponse && (
             <div className="bg-[#161b22] p-10 rounded-[2.5rem] border border-[#30363d] shadow-2xl relative overflow-hidden print:bg-white print:border-slate-300 print:text-black">
                <div className="text-[15px] text-[#c9d1d9] leading-[1.9] border-l-4 border-[#30363d] pl-8 print:text-slate-800 print:border-[#388bfd] font-mono whitespace-pre-wrap print:font-sans">
                   {aiResponse}
                </div>
             </div>
           )}
        </div>

        {/* ç»ˆç«¯äº¤äº’ */}
        <div className="bg-[#0d1117] p-8 rounded-[3rem] border border-[#30363d] shadow-2xl no-print">
          <div className="flex gap-4">
            <span className="text-[#58a6ff] font-bold mt-4">$</span>
            <input 
              type="text" 
              value={chatInput}
              onChange={(e) => setChatInput(e.target.value)}
              placeholder="è¾“å…¥æŸ¥è¯¢å‘½ä»¤: git analyse --u13-project --stock-ytl"
              className="flex-grow bg-transparent border-none py-4 text-sm font-mono text-white focus:ring-0 outline-none"
              onKeyDown={(e) => e.key === 'Enter' && handleChat()}
            />
            <button onClick={handleChat} disabled={aiLoading || !chatInput.trim()} className="px-10 bg-[#21262d] hover:bg-[#30363d] border border-[#30363d] text-white rounded-xl font-bold text-xs uppercase tracking-widest transition-all">
              {aiLoading ? <Loader2 className="animate-spin" size={18} /> : 'RUN'}
            </button>
          </div>
        </div>
      </div>
      
      <style>{`
        @keyframes bounce-slow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        .animate-bounce-slow { animation: bounce-slow 3s ease-in-out infinite; }
        @media print {
          body { background-color: white !important; color: black !important; padding: 0 !important; }
          .no-print { display: none !important; }
          .only-print { display: block !important; }
          .min-h-screen { min-height: auto !important; background: white !important; padding: 0 !important; }
          .max-w-6xl { max-width: 100% !important; margin: 0 !important; padding: 15px !important; }
          #report-content { display: grid !important; }
          svg polygon, svg line { stroke: #000 !important; opacity: 0.3 !important; }
          page-break-inside: avoid;
        }
        .only-print { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }
      `}</style>
    </div>
  );
};

export default App;
